# 数据存储升级说明 - 简化版

## 概述

**Lyfe's Prompt Hub** 已完成重大架构升级，移除了用户登录注册系统，简化为直接使用模式，并使用VS Code ExtensionContext替代localStorage进行数据存储，确保数据的持久性和安全性。

### 主要改进

1. **移除用户系统** - 简化为直接使用模式，更符合VS Code扩展的使用习惯
2. **持久化存储** - 使用VS Code的globalState/workspaceState替代localStorage
3. **自动备份** - 定期自动创建本地备份，防止数据丢失
4. **云同步功能** - 支持GitHub Gist、Gitee Gist、GitLab Snippets、WebDAV和自定义API同步
5. **工作区模式** - 支持全局存储和工作区存储两种模式
6. **导入导出** - 完整的数据导入导出功能

## 新功能特性

### 1. 简化的用户体验
- **无需注册登录** - 安装后直接使用
- **即开即用** - 启动扩展后立即可以管理提示词
- **专注核心功能** - 专注于提示词的创建、管理和使用

### 2. 双模式存储
- **全局模式**：数据存储在用户全局设置中，所有项目共享
- **工作区模式**：数据存储在当前工作区，项目隔离

### 3. 自动备份系统
- **定时备份**：每30分钟自动创建备份
- **备份管理**：保留最近10个备份文件
- **一键恢复**：支持从备份快速恢复数据

### 4. 云同步服务
- **GitHub Gist**：使用GitHub Personal Access Token同步
- **Gitee Gist**：使用Gitee Private Token同步  
- **GitLab Snippets**：使用GitLab Personal Access Token同步
- **WebDAV**：通过WebDAV协议同步到自托管服务器
- **自定义API**：支持自定义云存储服务

### 5. 数据管理
- **导出功能**：将所有数据导出为JSON文件
- **导入功能**：从JSON文件导入数据（支持安全确认）
- **数据统计**：查看存储模式、提示词数量等信息

## 数据结构

### 简化后的数据结构
```typescript
export interface Prompt {
    id: number;
    title: string;
    content: string;
    category: string;
    tags: string[];
    isActive: boolean;
    createdAt: string;
    updatedAt: string;
}

export interface AppData {
    prompts: Prompt[];
    categories: string[];
    settings: {
        autoBackup: boolean;
        backupInterval: number;
        cloudSync: boolean;
        syncProvider: 'github' | 'gitee' | 'custom' | null;
        workspaceMode: boolean;
    };
    metadata: {
        version: string;
        lastModified: string;
        totalPrompts: number;
    };
}
```

## 使用方法

### 基本操作
1. **安装扩展**：通过`.vsix`文件安装到Cursor
2. **打开面板**：点击侧边栏的"Prompt Hub"图标
3. **添加提示词**：点击右下角的"+"按钮
4. **管理分类**：在设置中可以管理分类
5. **搜索过滤**：使用顶部搜索框和分类标签过滤

### 存储模式切换
1. **查看当前模式**：命令面板执行`Prompt Hub: 查看存储信息`
2. **切换模式**：命令面板执行`Prompt Hub: 切换存储模式`
3. **全局模式**：数据在所有项目间共享
4. **工作区模式**：数据仅在当前工作区有效

### 数据备份与恢复
1. **手动备份**：命令面板执行`Prompt Hub: 创建备份`
2. **恢复备份**：命令面板执行`Prompt Hub: 恢复备份`
3. **自动备份**：系统每30分钟自动创建备份
4. **备份位置**：扩展目录的`backups`文件夹

### 云同步配置

#### GitHub Gist同步
1. 生成Personal Access Token（需要gist权限）
2. 执行命令`Prompt Hub: 设置云同步`
3. 选择GitHub Gist
4. 输入Token和可选的Gist ID

#### Gitee Gist同步  
1. 生成Private Token
2. 执行命令`Prompt Hub: 设置云同步`
3. 选择Gitee Gist
4. 输入Token

#### GitLab Snippets同步
1. 在GitLab生成Personal Access Token（需要`api`权限）
2. 执行命令`Prompt Hub: 设置云同步`
3. 选择GitLab Snippets
4. 输入Token和可选的Snippet ID
5. 如果使用自托管GitLab，还需输入实例URL

#### WebDAV同步
1. 准备好你的WebDAV服务器信息（URL、用户名、密码）
2. 执行命令`Prompt Hub: 设置云同步`
3. 选择WebDAV
4. 输入服务器URL、用户名、密码和远程路径

#### 自定义API同步
1. 准备支持PUT/GET的API接口
2. 执行命令`Prompt Hub: 设置云同步`
3. 选择自定义API
4. 输入API地址和密钥

### 数据导入导出
1. **导出数据**：命令面板执行`Prompt Hub: 导出数据`
2. **导入数据**：命令面板执行`Prompt Hub: 导入数据`
3. **格式支持**：标准JSON格式
4. **安全机制**：导入前自动备份现有数据

## 技术实现

### 存储机制
```typescript
// 全局存储
context.globalState.update('promptHub.appData', data);

// 工作区存储  
context.workspaceState.update('promptHub.workspaceData', data);
```

### 备份策略
- **存储位置**：`{extensionPath}/backups/`
- **文件命名**：`prompt-hub-backup-{timestamp}.json`
- **清理机制**：自动删除超过10个的旧备份

### 云同步实现
- **数据格式**：JSON格式，包含时间戳和版本信息
- **冲突处理**：用户手动选择覆盖或取消
- **安全机制**：所有操作前自动备份

### 前后端通信
```typescript
// Webview到Extension
window.parent.postMessage({
    type: 'getAppData'
}, '*');

// Extension到Webview
webview.postMessage({
    type: 'appDataResponse',
    data: appData
});
```

## 命令列表

| 命令 | 功能 | 图标 |
|------|------|------|
| `promptHub.openPanel` | 打开Prompt Hub面板 | 📖 |
| `promptHub.refresh` | 刷新界面 | 🔄 |
| `promptHub.exportData` | 导出数据 | 📤 |
| `promptHub.importData` | 导入数据 | 📥 |
| `promptHub.createBackup` | 创建备份 | 💾 |
| `promptHub.restoreBackup` | 恢复备份 | 📋 |
| `promptHub.setupCloudSync` | 设置云同步 | ☁️ |
| `promptHub.syncToCloud` | 同步到云端 | ⬆️ |
| `promptHub.syncFromCloud` | 从云端同步 | ⬇️ |
| `promptHub.toggleWorkspaceMode` | 切换存储模式 | 📁 |
| `promptHub.showStorageInfo` | 查看存储信息 | ℹ️ |

## 升级优势

### 对比旧版本
| 特性 | 旧版本 | 新版本 |
|------|---------|---------|
| 数据存储 | localStorage | VS Code ExtensionContext |
| 用户系统 | 需要注册登录 | 直接使用 |
| 数据持久化 | 不稳定 | 完全持久化 |
| 备份功能 | 无 | 自动+手动备份 |
| 云同步 | 无 | 多平台云同步 |
| 工作区支持 | 无 | 全局/工作区双模式 |
| 扩展迁移 | 数据丢失 | 自动迁移 |

### 安全性提升
- **数据隔离**：使用VS Code官方存储API
- **备份保护**：多重备份防止数据丢失
- **导入验证**：导入数据前进行格式验证
- **操作确认**：危险操作需要用户确认

## 故障排除

### 数据丢失问题
1. **检查备份**：查看`backups`文件夹中的备份文件
2. **恢复备份**：使用`恢复备份`命令选择最近的备份
3. **云同步恢复**：如果配置了云同步，可从云端恢复

### 存储模式问题
1. **检查当前模式**：使用`查看存储信息`命令
2. **切换模式**：使用`切换存储模式`命令
3. **数据迁移**：切换模式时会自动迁移数据

### 云同步问题
1. **检查网络**：确保网络连接正常
2. **验证Token**：确认GitHub/Gitee Token有效
3. **重新配置**：重新执行云同步设置

### 性能问题
1. **备份清理**：系统自动清理旧备份文件
2. **数据压缩**：大数据量时考虑分类整理
3. **重启扩展**：重启VS Code刷新扩展状态

## 开发者说明

### 构建流程
```bash
# 编译TypeScript
npm run compile

# 打包扩展
npm run package

# 生成lyfes-prompt-hub-0.1.0.vsix文件
```

### 安装方式
1. 在Cursor中按`Ctrl+Shift+P`
2. 输入`Extensions: Install from VSIX...`
3. 选择生成的`.vsix`文件
4. 重启Cursor完成安装

### 目录结构
```
lyfes-prompt-hub/
├── src/
│   ├── extension.ts          # 扩展入口
│   ├── dataManager.ts        # 数据管理核心
│   ├── promptHubProvider.ts  # WebView提供者
│   └── webviewDataBridge.js  # 前端数据桥接
├── backups/                  # 自动生成的备份目录
├── prompt_hub_mockup.html    # 简化版前端界面
└── package.json              # 扩展配置
```

## 更新日志

### v0.1.0 - 简化版本
- ✅ 移除用户登录注册系统
- ✅ 简化为直接使用模式
- ✅ 实现VS Code ExtensionContext存储
- ✅ 添加自动备份功能
- ✅ 支持云同步（GitHub/Gitee/自定义API）
- ✅ 添加工作区存储模式
- ✅ 完善数据导入导出功能
- ✅ 更新前端界面为简化版本
- ✅ 添加11个管理命令
- ✅ 完善错误处理和用户反馈

## 总结

这次升级将**Lyfe's Prompt Hub**转变为一个更加专业、可靠的VS Code扩展。通过移除复杂的用户系统，专注于核心的提示词管理功能，同时提供强大的数据管理和同步能力，为用户提供更好的使用体验。

### 主要收益
1. **简化使用** - 无需注册登录，即装即用
2. **数据安全** - 多重备份机制，永不丢失
3. **灵活存储** - 全局/工作区双模式适应不同需求
4. **云端同步** - 多设备数据同步，随时随地访问
5. **专业体验** - 符合VS Code生态的使用习惯

新版本更加稳定、安全、易用，真正实现了"专业的提示词管理工具"的目标。 